<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Gempire Discovery</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  body {
    margin: 0;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: radial-gradient(1200px 600px at top, #0b1a44, #020617);
    color: #fff;
  }

  header {
    padding: 32px;
  }

  h1 {
    margin: 0 0 8px;
    font-size: 32px;
  }

  .subtitle {
    color: #9aa4d6;
    margin-bottom: 16px;
  }

  .search-row {
    display: flex;
    gap: 12px;
  }

  input[type="text"] {
    flex: 1;
    padding: 14px 16px;
    border-radius: 10px;
    border: none;
    font-size: 16px;
  }

  button {
    padding: 14px 22px;
    border-radius: 10px;
    border: none;
    background: #5b6cff;
    color: #fff;
    font-weight: 600;
    cursor: pointer;
  }

  .tabs {
    display: flex;
    gap: 20px;
    padding: 0 32px 12px;
    color: #9aa4d6;
  }

  .tabs span {
    cursor: pointer;
  }

  .tabs .active {
    color: #fff;
    text-decoration: underline;
  }

  .sort-row {
    padding: 0 32px 16px;
  }

  .layout {
    display: grid;
    grid-template-columns: 260px 1fr;
    gap: 32px;
    padding: 0 32px 48px;
  }

  .filters {
    position: sticky;
    top: 20px;
    background: rgba(255,255,255,0.04);
    padding: 20px;
    border-radius: 16px;
  }

  .filters h3 {
    margin-top: 0;
  }

  .price-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .price-row input {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: none;
  }

  .apply-btn {
    margin-top: 12px;
    width: 100%;
  }

  #results {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 24px;
  }

  .card {
    background: rgba(255,255,255,0.05);
    padding: 14px;
    border-radius: 16px;
  }

  .card img {
    width: 100%;
    border-radius: 12px;
    object-fit: contain;
    background: #000;
  }

  .card h4 {
    font-size: 14px;
    margin: 10px 0 6px;
  }

  .price {
    font-weight: 700;
    margin-bottom: 6px;
  }

  .card a {
    color: #7da2ff;
    font-size: 14px;
    text-decoration: none;
  }

  @media (max-width: 900px) {
    .layout {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>

<body>

<header>
  <h1>Gempire Discovery</h1>
  <div class="subtitle">Search Pokémon cards across eBay</div>

  <div class="search-row">
    <input id="query" type="text" placeholder="Search Pokémon PSA cards…" />
    <button onclick="search()">Search</button>
  </div>
</header>

<div class="tabs">
  <span class="active">All Items</span>
  <span>Auctions</span>
  <span>Fixed Price</span>
</div>

<div class="sort-row">
  Sort by
  <select id="sort" onchange="search()">
    <option value="">Best Match</option>
    <option value="price_asc">Price: Low → High</option>
    <option value="price_desc">Price: High → Low</option>
    <option value="newly_listed">Newly Listed</option>
  </select>
</div>

<div class="layout">
  <div class="filters">
    <h3>Filters</h3>

    <div class="price-row">
      <input id="minPrice" placeholder="$ Min" />
      <span>to</span>
      <input id="maxPrice" placeholder="$ Max" />
    </div>

    <button class="apply-btn" onclick="search()">Apply</button>
  </div>

  <div id="results"></div>
</div>

<script>
  function formatMoney(n) {
    return "$" + Number(n).toLocaleString("en-US");
  }

  function cleanNumber(v) {
    return v.replace(/[^0-9]/g, "");
  }

  function formatInput(el) {
    const raw = cleanNumber(el.value);
    el.value = raw ? formatMoney(raw) : "";
  }

  async function search() {
    const grid = document.getElementById("results");
    grid.innerHTML = "<p style='color:#9aa4d6'>Loading listings…</p>";

    try {
      const q = document.getElementById("query").value || "pokemon psa";
      const min = cleanNumber(document.getElementById("minPrice").value);
      const max = cleanNumber(document.getElementById("maxPrice").value);
      const sort = document.getElementById("sort").value;

      let url = `/api/search?q=${encodeURIComponent(q)}`;
      if (min) url += `&min=${min}`;
      if (max) url += `&max=${max}`;
      if (sort) url += `&sort=${sort}`;

      const res = await fetch(url);
      const data = await res.json();

      grid.innerHTML = "";

      if (!data.items || data.items.length === 0) {
        grid.innerHTML = "<p style='color:#9aa4d6'>No results found.</p>";
        return;
      }

      data.items.forEach(item => {
        const price = Number(item.price);
        if (!price || isNaN(price)) return;

        const img = item.image
          ? item.image.replace(/s-l\d+/i, "s-l1600")
          : "";

        grid.innerHTML += `
          <div class="card">
            <img src="${img}" loading="lazy" />
            <h4>${item.title}</h4>
            <div class="price">${formatMoney(price)}</div>
            <a href="${item.link}" target="_blank">View</a>
          </div>
        `;
      });

    } catch (e) {
      console.error(e);
      grid.innerHTML = "<p style='color:#ff6b6b'>Error loading listings.</p>";
    }
  }

  document.getElementById("minPrice").addEventListener("input", e => formatInput(e.target));
  document.getElementById("maxPrice").addEventListener("input", e => formatInput(e.target));

  window.addEventListener("load", () => {
    document.getElementById("query").value = "pokemon psa";
    document.getElementById("minPrice").value = "$3,000";
    search();
  });
</script>

</body>
</html>
